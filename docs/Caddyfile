# Caddyfile for Gearbox Catalog Frontend Development Server
# This serves the frontend files and handles CORS for API requests

# Main site - serves from docs directory
:8080 {
    # Serve static files from current directory
    file_server
    
    # Enable directory browsing for development
    file_server browse
    
    # Default to index.html
    try_files {path} {path}/ index.html
    
    # Add CORS headers to allow API calls
    header {
        Access-Control-Allow-Origin "*"
        Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
        Access-Control-Allow-Headers "Content-Type, Authorization, x-api-key"
        Access-Control-Max-Age "86400"
    }
    
    # Handle preflight OPTIONS requests
    respond /api/* 200 {
        close
    }
    
    # Add security headers
    header {
        X-Content-Type-Options "nosniff"
        X-Frame-Options "DENY"
        X-XSS-Protection "1; mode=block"
        Referrer-Policy "strict-origin-when-cross-origin"
    }
    
    # Enable compression
    encode gzip
    
    # Log requests for development
    log {
        output file /var/log/caddy/gearbox-frontend.log
        format json
    }
}

# Development proxy for local Lambda testing (optional)
# Uncomment and modify if you want to proxy API calls to local SAM
# :8081 {
#     reverse_proxy /gearboxes/* localhost:3000
#     reverse_proxy /hello/* localhost:3000
# }